{"componentChunkName":"component---src-templates-blog-post-js","path":"/docker-compose-major-changes-since-october-2023/","result":{"data":{"site":{"siteMetadata":{"title":"Boris's Blog"}},"markdownRemark":{"id":"fd3d1839-3963-5144-a30c-f4e7e632c8e4","excerpt":"Docker Compose Evolution: Major Changes Since October 2023 Since October 2023, Docker Compose has undergone significant evolution with important structuralâ€¦","html":"<h1>Docker Compose Evolution: Major Changes Since October 2023</h1>\n<p>Since October 2023, Docker Compose has undergone significant evolution with important structural changes, new features, and improvements in developer experience. This comprehensive guide covers the major updates and changes that developers should be aware of.</p>\n<hr>\n<h2>Breaking Changes and Deprecations</h2>\n<h3>Version Field Deprecation</h3>\n<p>The <code class=\"language-text\">version</code> field in <code class=\"language-text\">docker-compose.yaml</code> is now completely deprecated. Modern Docker Compose files should no longer include version specifications:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># OLD (Deprecated)</span>\n<span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n\n<span class=\"token comment\"># NEW (Recommended)</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx</code></pre></div>\n<h3>Docker Compose Command Changes</h3>\n<p>The standalone <code class=\"language-text\">docker-compose</code> (with hyphen) command is now considered legacy and is in maintenance mode:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># OLD (Deprecated)</span>\n<span class=\"token function\">docker-compose</span> up <span class=\"token parameter variable\">-d</span>\n\n<span class=\"token comment\"># NEW (Recommended)</span>\n<span class=\"token function\">docker</span> compose up <span class=\"token parameter variable\">-d</span></code></pre></div>\n<p><strong>Key Points:</strong></p>\n<ul>\n<li><code class=\"language-text\">docker compose</code> is now integrated directly into the Docker CLI.</li>\n<li>The Python-based <code class=\"language-text\">docker-compose</code> tool is only receiving maintenance updates.</li>\n<li>New features are exclusively added to <code class=\"language-text\">docker compose</code>.</li>\n<li>Modern Docker Desktop installations default to <code class=\"language-text\">docker compose</code>.</li>\n</ul>\n<h3>Additional Deprecations</h3>\n<p>Several legacy fields are now discouraged:</p>\n<ul>\n<li><strong><code class=\"language-text\">links</code></strong>: Use Docker networks instead.</li>\n<li><strong><code class=\"language-text\">container_name</code></strong>: Allow Docker to manage container names dynamically.</li>\n<li><strong>Legacy volume mount syntax</strong>: Use the new long-form syntax.</li>\n<li><strong>Direct use of host ports without ranges</strong>: Use port ranges when possible.</li>\n</ul>\n<hr>\n<h2>Major YAML Structure Updates</h2>\n<h3>Enhanced Service Definitions</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\">#file: noinspection ComposeMissingKeys</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">myapp</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> buildno=1\n      <span class=\"token key atrule\">ssh</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> default=/path/to/key\n      <span class=\"token key atrule\">network</span><span class=\"token punctuation\">:</span> host\n      <span class=\"token key atrule\">platforms</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"linux/amd64\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"linux/arm64\"</span>\n\n    <span class=\"token key atrule\">healthcheck</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">start_period</span><span class=\"token punctuation\">:</span> 30s\n      <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 10s\n      <span class=\"token key atrule\">retries</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n      <span class=\"token key atrule\">start_interval</span><span class=\"token punctuation\">:</span> 5s</code></pre></div>\n<h3>Improved Dependencies and Conditions</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">condition</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"service_healthy\"</span>\n        <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<h3>Modern Volume Mount Syntax</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> bind\n        <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span> ./app\n        <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> /app\n        <span class=\"token key atrule\">bind</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">create_host_path</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> volume\n        <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span> data\n        <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> /data\n        <span class=\"token key atrule\">volume</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">nocopy</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<hr>\n<h2>New Features and CLI Enhancements</h2>\n<h3>New Commands</h3>\n<ol>\n<li><strong><code class=\"language-text\">docker compose attach</code></strong>: Attach to service containers for debugging.</li>\n<li><strong><code class=\"language-text\">docker compose stats</code></strong>: Live resource usage monitoring.</li>\n<li><strong><code class=\"language-text\">docker compose watch</code></strong>: Automatic service updates during development.</li>\n<li><strong><code class=\"language-text\">docker compose logs --index</code></strong>: Select logs from specific replicas.</li>\n<li><strong><code class=\"language-text\">docker compose exec --privileged</code></strong>: Run commands inside a container with elevated privileges.</li>\n<li><strong><code class=\"language-text\">docker compose cp</code></strong>: Copy files between the host and a service's container.</li>\n</ol>\n<h3>Enhanced Build and Deploy Options</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Build with dependencies</span>\n<span class=\"token function\">docker</span> compose build --with-dependencies\n\n<span class=\"token comment\"># Convert compose files</span>\n<span class=\"token function\">docker</span> compose convert --no-path-resolution\n\n<span class=\"token comment\"># Enhanced profile management</span>\n<span class=\"token function\">docker</span> compose <span class=\"token parameter variable\">--profile</span> prod <span class=\"token parameter variable\">--profile</span> dev up\n<span class=\"token function\">docker</span> compose --profile-inherit<span class=\"token operator\">=</span>false up\n\n<span class=\"token comment\"># Improved service operations</span>\n<span class=\"token function\">docker</span> compose up <span class=\"token parameter variable\">--wait</span>\n<span class=\"token function\">docker</span> compose up --quiet-pull\n<span class=\"token function\">docker</span> compose down --remove-orphans</code></pre></div>\n<hr>\n<h2>Docker Compose Watch</h2>\n<h3>File Watch Configuration</h3>\n<p>The new <code class=\"language-text\">x-develop</code> section in the Docker Compose file allows for more sophisticated control over file watching and service updates:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">x-develop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">watch</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./src\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> sync\n          <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> /app/src\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./package.json\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> rebuild</code></pre></div>\n<h3>Watch Features</h3>\n<ul>\n<li><strong>Automatic service updates</strong> during development.</li>\n<li><strong>Configurable watch paths</strong> and actions (e.g., sync, rebuild).</li>\n<li><strong>Synchronized file updates</strong> without rebuilds.</li>\n<li><strong>Selective rebuild triggers</strong>.</li>\n<li>Support for <strong>multiple watch configurations</strong> per service.</li>\n</ul>\n<hr>\n<h2>Security and Resource Management</h2>\n<h3>Security Improvements</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">security_opt</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> no<span class=\"token punctuation\">-</span>new<span class=\"token punctuation\">-</span>privileges<span class=\"token punctuation\">:</span><span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">cap_drop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ALL\n    <span class=\"token key atrule\">cap_add</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> NET_ADMIN</code></pre></div>\n<h3>Security Updates</h3>\n<ul>\n<li><strong>Critical patches</strong> for remote code execution (RCE) vulnerabilities in Docker extensions.</li>\n<li>Enhanced <strong>validation of extension descriptions</strong> and publisher URLs.</li>\n<li>Improved <strong>container isolation defaults</strong>.</li>\n<li>Regular <strong>security maintenance releases</strong>.</li>\n</ul>\n<h3>Resource Management</h3>\n<ul>\n<li>Introduction of <strong>Resource Saver mode</strong> in Docker Desktop to reduce memory footprint when idle.</li>\n<li>Improved handling of <strong>container lifecycle</strong>.</li>\n<li>Better <strong>network conflict detection</strong>.</li>\n<li>Enhanced <strong>build cache management</strong> with layer optimization.</li>\n<li>More efficient handling of <strong>build cache layers</strong>.</li>\n<li>Optimized <strong>cache invalidation strategies</strong>.</li>\n</ul>\n<hr>\n<h2>Docker Desktop Integration</h2>\n<h3>Compose Watch GA Release</h3>\n<ul>\n<li><strong>Docker Desktop 4.24</strong> introduced the Compose Watch GA release.</li>\n<li>Allows developers to <strong>automatically update and preview running services</strong> as they edit code without manually triggering builds.</li>\n<li>Significantly enhances the <strong>\"inner loop\" of development</strong> by reducing manual steps.</li>\n</ul>\n<h3>Resource Optimization</h3>\n<ul>\n<li><strong>Resource Saver mode</strong> for reduced memory footprint.</li>\n<li>Better handling of <strong>idle resources</strong>.</li>\n<li>Improved <strong>performance</strong> during development.</li>\n<li>Optimized <strong>build cache handling</strong>.</li>\n</ul>\n<hr>\n<h2>Migration Tips</h2>\n<ol>\n<li><strong>Remove</strong> the <code class=\"language-text\">version</code> field from all compose files.</li>\n<li><strong>Update CI/CD pipelines</strong> to use <code class=\"language-text\">docker compose</code> instead of <code class=\"language-text\">docker-compose</code>.</li>\n<li><strong>Review and update documentation</strong> and scripts accordingly.</li>\n<li>Verify the <strong>Go-based implementation</strong> with <code class=\"language-text\">docker compose version</code>.</li>\n<li><strong>Test services</strong> with new dependency handling.</li>\n<li>Review <strong>security configurations</strong>.</li>\n<li>Replace <strong>deprecated fields</strong> with modern alternatives.</li>\n<li>Update <strong>file watch configurations</strong> to use <code class=\"language-text\">x-develop</code>.</li>\n</ol>\n<hr>\n<h2>Best Practices</h2>\n<ol>\n<li>Use <strong>Docker networks</strong> instead of legacy linking (<code class=\"language-text\">links</code>).</li>\n<li>Implement proper <strong>healthchecks</strong> for service dependencies.</li>\n<li>Utilize <strong>build cache optimization</strong> features.</li>\n<li>Configure appropriate <strong>resource limits</strong>.</li>\n<li>Implement proper <strong>security measures</strong>.</li>\n<li>Use modern <strong>volume mount syntax</strong>.</li>\n<li>Leverage <strong>file watch</strong> for development efficiency.</li>\n</ol>\n<hr>\n<h2>Looking Forward</h2>\n<p>Docker Compose follows a rolling release model, and new features are continuously being added. Stay updated with the latest advancements by regularly consulting the official Docker documentation and release notes.</p>\n<hr>\n<h2>Related Resources</h2>\n<ul>\n<li><a href=\"https://docs.docker.com/compose/release-notes/\">Docker Compose Release Notes</a></li>\n<li><a href=\"https://docs.docker.com/desktop/\">Docker Desktop Documentation</a></li>\n<li><a href=\"https://docs.docker.com/compose/compose-file/\">Compose Specification</a></li>\n<li><a href=\"https://www.docker.com/blog/\">Docker Blog</a></li>\n<li><a href=\"https://docs.docker.com/security/\">Docker Security Updates</a></li>\n<li><a href=\"https://docs.docker.com/compose/compose-file/#x-develop\">Docker Compose Watch Documentation</a></li>\n</ul>","frontmatter":{"title":"Docker Compose Evolution: Major Changes Since October 2023","date":"November 20, 2024","description":"Explore the significant updates and new features in Docker Compose since October 2023, including breaking changes, new commands, and best practices for modern development.","imageCaption":"An overview of Docker Compose's evolution and new features","tags":null,"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"https://bdteo.github.io/static/bc3877daf612bce2d881507119f045a5/869a6/featured.jpg","srcSet":"https://bdteo.github.io/static/bc3877daf612bce2d881507119f045a5/0f5ce/featured.jpg 750w,\nhttps://bdteo.github.io/static/bc3877daf612bce2d881507119f045a5/b74b1/featured.jpg 1080w,\nhttps://bdteo.github.io/static/bc3877daf612bce2d881507119f045a5/6e2bb/featured.jpg 1366w,\nhttps://bdteo.github.io/static/bc3877daf612bce2d881507119f045a5/869a6/featured.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"https://bdteo.github.io/static/bc3877daf612bce2d881507119f045a5/4f03f/featured.webp 750w,\nhttps://bdteo.github.io/static/bc3877daf612bce2d881507119f045a5/4f506/featured.webp 1080w,\nhttps://bdteo.github.io/static/bc3877daf612bce2d881507119f045a5/f0a0a/featured.webp 1366w,\nhttps://bdteo.github.io/static/bc3877daf612bce2d881507119f045a5/26222/featured.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}}}},"previous":{"fields":{"slug":"/unlocking-the-power-of-git-grep/"},"frontmatter":{"title":"The Hidden Path: Unlocking the Power of ..."}},"next":{"fields":{"slug":"/understanding-class-namespace-changes-shopware-6-5-developers-guide/"},"frontmatter":{"title":"Understanding Class and Namespace Changes in Shopware 6.5 and 6.6: A Developer's Guide"}}},"pageContext":{"id":"fd3d1839-3963-5144-a30c-f4e7e632c8e4","previousPostId":"d669d689-35c9-565d-8773-a561c2b952d3","nextPostId":"aebd6da9-0097-58e7-8ebb-b65a9f4e752f"}},"staticQueryHashes":["2923011943","3464938722"],"slicesMap":{}}